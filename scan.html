<!DOCTYPE html>
<html>
<head>
  <title>Invoice Scanner</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #message { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Invoice Scanner</h2>

  <form id="invoiceForm">
    <label>Invoice No:</label><br>
    <input type="text" id="invoiceNo" readonly><br><br>

    <label>Status:</label><br>
    <select id="status" required>
      <option value="">--Select--</option>
      <option value="OUT">OUT</option>
      <option value="RETURNED">RETURNED</option>
    </select><br><br>

    <button type="submit">Submit</button>
  </form>

  <div id="message"></div>

  <script>
    // Read URL params (works for ?code= or ?q=)
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code') || params.get('q') || '';

    if (code) {
      document.getElementById('invoiceNo').value = code;
    }

    document.getElementById('invoiceForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const invoiceNo = document.getElementById('invoiceNo').value;
      const status = document.getElementById('status').value;

      if (!invoiceNo || !status) {
        document.getElementById('message').innerHTML = "⚠️ Missing data.";
        return;
      }

      const scriptURL = "https://script.google.com/macros/s/AKfycbyhWcenMggzMkH3bIPSrPMjCloy0TD10Ik7Y3ubfCVTRb6mpTreETAtAQkXJ9-UYg/exec";
      document.getElementById('message').innerHTML = "⏳ Sending data...";

      fetch(`${scriptURL}?invoiceNo=${encodeURIComponent(invoiceNo)}&status=${encodeURIComponent(status)}`)
        .then(res => res.text())
        .then(text => {
          document.getElementById('message').innerHTML = `<span style="color:green;">✅ ${text}</span>`;
        })
        .catch(err => {
          document.getElementById('message').innerHTML = `<span style="color:red;">❌ Error: ${err}</span>`;
        });
    });
  </script>
</body>
</html>
